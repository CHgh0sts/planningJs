"use strict";(()=>{var e={};e.id=818,e.ids=[818],e.modules={3524:e=>{e.exports=require("@prisma/client")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},4770:e=>{e.exports=require("crypto")},6162:e=>{e.exports=require("stream")},1764:e=>{e.exports=require("util")},623:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>w,patchFetch:()=>q,requestAsyncStorage:()=>f,routeModule:()=>g,serverHooks:()=>v,staticGenerationAsyncStorage:()=>h});var s={};t.r(s),t.d(s,{POST:()=>x});var n=t(3278),o=t(5002),i=t(4877),a=t(3524),u=t(3506),p=t.n(u),c=t(7390),d=t.n(c),l=t(1309);let m=new a.PrismaClient;async function x(e){let{username:r,password:t}=await e.json();if(!r||!t)return l.NextResponse.json({error:"Nom d'utilisateur et mot de passe requis"},{status:400});try{let e=await m.user.findUnique({where:{username:r}});if(!e)return l.NextResponse.json({error:"Identifiants incorrects"},{status:401});let s=!!e.password&&await p().compare(t.trim(),e.password),n=await p().compare(t.trim(),e.temp_password);if(!s&&!n)return l.NextResponse.json({error:"Identifiants incorrects"},{status:401});let o=d().sign({userId:e.id},process.env.JWT_SECRET,{expiresIn:"1h"});return l.NextResponse.json({token:o,user:{id:e.id,username:e.username},isTempPassword:n},{status:200})}catch(e){return console.error("Erreur lors de la connexion :",e),l.NextResponse.json({error:"Erreur serveur"},{status:500})}}let g=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/account/login/route",pathname:"/api/account/login",filename:"route",bundlePath:"app/api/account/login/route"},resolvedPagePath:"/Users/chghosts/Developpement/planningJs/app/api/account/login/route.js",nextConfigOutput:"",userland:s}),{requestAsyncStorage:f,staticGenerationAsyncStorage:h,serverHooks:v}=g,w="/api/account/login/route";function q(){return(0,i.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:h})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[379,833,390,506],()=>t(623));module.exports=s})();