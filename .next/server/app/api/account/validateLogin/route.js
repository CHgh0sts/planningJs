"use strict";(()=>{var e={};e.id=871,e.ids=[871],e.modules={3524:e=>{e.exports=require("@prisma/client")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},4770:e=>{e.exports=require("crypto")},6162:e=>{e.exports=require("stream")},1764:e=>{e.exports=require("util")},2467:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>f,patchFetch:()=>R,requestAsyncStorage:()=>g,routeModule:()=>v,serverHooks:()=>j,staticGenerationAsyncStorage:()=>h});var s={};t.r(s),t.d(s,{PUT:()=>m});var o=t(3278),n=t(5002),a=t(4877),i=t(3524),u=t(3506),p=t.n(u),d=t(7390),c=t.n(d),l=t(1309);let x=new i.PrismaClient;async function m(e){let{newPassword:r,confirmPassword:t}=await e.json(),s=e.headers.get("Authorization")?.replace("Bearer ","");if(!s)return l.NextResponse.json({error:"Token manquant"},{status:401});if(r!==t)return l.NextResponse.json({error:"Les mots de passe ne correspondent pas"},{status:400});try{let e=c().verify(s,process.env.JWT_SECRET);if(!e||!e.userId)return l.NextResponse.json({error:"Token invalide"},{status:401});let t=await p().hash(r,10),o=await x.user.update({where:{id:e.userId},data:{password:t,temp_password:""}}),n=c().sign({userId:o.id},process.env.JWT_SECRET,{expiresIn:"1h"});return l.NextResponse.json({token:n,message:"Mot de passe mis \xe0 jour avec succ\xe8s"},{status:200})}catch(e){if(console.error("Erreur lors de la mise \xe0 jour du mot de passe :",e),"JsonWebTokenError"===e.name)return l.NextResponse.json({error:"Token invalide"},{status:401});if("TokenExpiredError"===e.name)return l.NextResponse.json({error:"Token expir\xe9"},{status:401});return l.NextResponse.json({error:"Erreur serveur"},{status:500})}}let v=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/account/validateLogin/route",pathname:"/api/account/validateLogin",filename:"route",bundlePath:"app/api/account/validateLogin/route"},resolvedPagePath:"/Users/chghosts/Developpement/planningJs/app/api/account/validateLogin/route.js",nextConfigOutput:"",userland:s}),{requestAsyncStorage:g,staticGenerationAsyncStorage:h,serverHooks:j}=v,f="/api/account/validateLogin/route";function R(){return(0,a.patchFetch)({serverHooks:j,staticGenerationAsyncStorage:h})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[379,833,390,506],()=>t(2467));module.exports=s})();