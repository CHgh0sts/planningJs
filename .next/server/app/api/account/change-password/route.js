"use strict";(()=>{var e={};e.id=284,e.ids=[284],e.modules={3524:e=>{e.exports=require("@prisma/client")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},4770:e=>{e.exports=require("crypto")},6162:e=>{e.exports=require("stream")},1764:e=>{e.exports=require("util")},582:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>f,patchFetch:()=>j,requestAsyncStorage:()=>g,routeModule:()=>x,serverHooks:()=>v,staticGenerationAsyncStorage:()=>w});var s={};t.r(s),t.d(s,{POST:()=>h});var a=t(3278),o=t(5002),n=t(4877),u=t(3524),i=t(7390),p=t.n(i),c=t(3506),d=t.n(c),l=t(1309);let m=new u.PrismaClient;async function h(e){let r=e.headers.get("Authorization")?.replace("Bearer ","");if(!r)return l.NextResponse.json({error:"Token manquant"},{status:401});try{let t=p().verify(r,process.env.JWT_SECRET),{currentPassword:s,newPassword:a}=await e.json();if(!s||!a)return l.NextResponse.json({error:"Les champs mot de passe actuel et nouveau mot de passe sont requis"},{status:400});let o=await m.user.findUnique({where:{id:t.userId}});if(!o)return l.NextResponse.json({error:"Utilisateur non trouv\xe9"},{status:404});if(!await d().compare(s,o.password))return l.NextResponse.json({error:"Ancien mot de passe incorrect"},{status:400});let n=await d().hash(a,10);return await m.user.update({where:{id:o.id},data:{password:n}}),l.NextResponse.json({message:"Mot de passe mis \xe0 jour avec succ\xe8s"},{status:200})}catch(e){return console.error("Erreur lors du changement de mot de passe:",e),l.NextResponse.json({error:"Erreur lors du changement de mot de passe"},{status:500})}}let x=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/account/change-password/route",pathname:"/api/account/change-password",filename:"route",bundlePath:"app/api/account/change-password/route"},resolvedPagePath:"/Users/chghosts/Developpement/planningJs/app/api/account/change-password/route.js",nextConfigOutput:"",userland:s}),{requestAsyncStorage:g,staticGenerationAsyncStorage:w,serverHooks:v}=x,f="/api/account/change-password/route";function j(){return(0,n.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:w})}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[379,833,390,506],()=>t(582));module.exports=s})();